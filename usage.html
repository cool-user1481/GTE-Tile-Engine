<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTE (GTE Tile Engine)</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Tiny5&display=swap');
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
            font-family: 'LanaPixel', 'Tiny5', monospace;
            color: white;
            user-select: none;
            position: relative;
            display: relative;
        }

        #canvas {
            display: absolute;
            z-index: 0;
        }
        
        #fpsMeter {
            z-index: 100;
            display: absolute;
            position: absolute;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="fpsMeter">FPS: --</div>
    <canvas id="canvas"></canvas>
    <div>Loading...</div><br>
  <script src="GTE.js"></script>  
  <script>
let atlas = new Image();
atlas.src = 'https://static.wikitide.net/cuberealmwiki/9/9a/Cuberealm_block_spritesheet.png'; 
let game;
let bgImg = new Image();
bgImg.src = "https://img.freepik.com/premium-vector/ground-seamless-pattern_172107-1588.jpg?w=2000";
const tileConfig = {
    smoothing: false,
    atlas: atlas,
    w: 16,
    h: 16,
    items: {
      wood_chest: {x:1,y:11},
      inferno_block: {x:14,y:3},
      water: {x:0,y:0},
      lava: {x:0,y:1},
    },
}

atlas.decode()
  .then(() => {
    bgImg.decode() // Waits until the atlas and background have loaded to start the game engine
  .then(() => {
    game = new GTEtileEngine(document.getElementById('canvas'), bgImg, tileConfig);
    game.canvas.addEventListener("mousedown", clickHandler)
    game.eventEmitter.addEventListener("tilePlace", (e) => placeHandler(e))
    game.eventEmitter.addEventListener("tileDelete", (e) => deleteHandler(e))
  });
});

function clickHandler(e){
    if (e.button === 0) { // Left click
        //console.log("left click")
        game.createTileAtMouse("lava");
    }
    if (e.button === 1) { // Middle click
        //console.log("middle click")
        e.preventDefault(); // Prevents the autoscroll stuff.
    }
    if (e.button === 2) { // Right click
        //console.log("Right click")
        game.deleteTileAtMouse();
    }
}

function placeHandler(e){
    console.log(`Tile ${e.detail.name} was placed`)
    
}

function deleteHandler(e){
    console.log(`Tile ${e.detail.name} was deleted`);
}


    </script>

<script>
(function() { // FPS counter
    const fpsDisplay = document.getElementById('fpsMeter');
    let lastFrameTime = performance.now();
    let frameCount = 0;
    let fps = 0;
    let lastFpsUpdate = performance.now();

    function updateFPS() {
        const now = performance.now();
        frameCount++;

        // Update FPS every 500ms so u can read the number before it updates
        if (now - lastFpsUpdate >= 500) {
            fps = (frameCount * 1000) / (now - lastFpsUpdate);
            fpsDisplay.textContent = `FPS: ${fps.toFixed(1)}`;
            lastFpsUpdate = now;
            frameCount = 0;
        }

        lastFrameTime = now;
        requestAnimationFrame(updateFPS);
    }

    requestAnimationFrame(updateFPS);
})();
</script>
</body>
</html>
